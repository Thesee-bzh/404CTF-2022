# Crypto / Un simple oracle [1/2]

## Challenge
Bonjour agent, Nous avons découvert un étrange service ouvert sur un des serveurs de Hallebarde. Il semble possible d'interagir avec lui. Pourrriez-vous récupérer son secret?

## Inputs
- server: `challenge.404ctf.fr:32128`

## Solution
Let's first connect to the server to check what's ahead of us.
```console
$ nc challenge.404ctf.fr 32128
Voici le message secret que je dois garder. Vous pouvez le voir, de toute façon vous ne pourrez rien en faire!
12386672229558380832941338208536153619947707493149124865863515075340381855514456986302106683581762921085489535699815544413764966642117957996599404631610960307379418889603039318545436003245518959589548332361745179995274302699371070222408839022036724630346660023991383359546728389254411550527615134693777246488740716969488353321063173792836246792814445654784224775408875964448457219252125483826293314982460469103956410065056909519464917889954119878023717542573622683433297588488602255182832934692032115756460781806938897636012894987203933874123597926100148668568657731672110148257828112047167999415989288777816296827513
J'en profite également pour noter quelques informations ici:
N = 26581573470903995274001422118088491908581616621413446199747702635611053675121681600711234041756222527739426743182854380171983265114526256651295898479025026575876676494921422779419926355695319214647483886943241181899484345182852768594805521367824674622905957283473032376008484035067469388350144445747497797798164938450792225358257996728568016984749173828287884651364805555464965548036669397277649703986468299767220423067021395570741891802595637374645015179873712251433606013793293420115233964972100203843000598549374498998088186105779327023895548091825106939743040360734661095642064829240849916608255853481460859742741
e = 65537

Ceci étant dit, passons à ce que vous vouliez me dire!

> 12
Voici ma réponse:
15734503611857384305228710508635492392967996485204776363591407711560541051592839892508420118779398316394437233850249692881433314938682012466595568608942482934429569331546636691400505618451808654781038044752719404672726214435428718913094215668977026267588425174547694616720773528230009476597509669439984245670522759619892505100459936941377269995986042810330337089589535761732449927400854508601856515796562948964056496659507990403389711566561774731908726958966879328428276000126852003134838707640705387540566841666926149185400713838053963734152217711162696323940815283369857169988843581965100779709089738114394407210983

> 12386672229558380832941338208536153619947707493149124865863515075340381855514456986302106683581762921085489535699815544413764966642117957996599404631610960307379418889603039318545436003245518959589548332361745179995274302699371070222408839022036724630346660023991383359546728389254411550527615134693777246488740716969488353321063173792836246792814445654784224775408875964448457219252125483826293314982460469103956410065056909519464917889954119878023717542573622683433297588488602255182832934692032115756460781806938897636012894987203933874123597926100148668568657731672110148257828112047167999415989288777816296827513
Je refuse de répondre à ceci
```

So this is a decipher Oracle, that allows to decipher anything but the secret itself.

Decipher Oracle is described here, in section `Decipher oracle`: [Attacking RSA for fun and CTF points - part 1](https://bitsdeep.com/posts/attacking-rsa-for-fun-and-ctf-points-part-1/)

Especially this explanation:
> Because the server check that you don’t ask for the decryption of the flag, you can’t give him C [aka the secret] right away, you need to modify it in a way to trick him into thinking it’s something else. Your modification must be carefully chosen so you can revert the process once you get the response of the server.

The trick is to multiply the ciphertext with another ciphertext c2 from which we know the plaintext: `c2 = 2^e [n]` will of course by deciphered as `2`.

Let `Fc` be the secret / ciphered flag and `F` be the flag. And let us submit this to the server for decryption: `C = Fc * c2 = F^e * 2^e = (2F)^e [n]`. The server will decrypt it as `2F [n]`.

So all we have to do is multiply the secret by `2^e`, get the decryption result from the server and divide it by 2 to obtain the flag.

Here is the main part of the Python script:
- `get_n_e_secret()` interacts with the server to get the public key (n, e) and the seccret
- `send_recv()` interacts with the server to submit something to decrypt and get the result
- the interaction with the server is implemented using `pwntools`

```python
def get_flag():
    n, e, secret = get_n_e_secret()
    c2 = pow(2, e)
    P = send_recv(secret*c2)
    F = P//2
    hex_ = hex(F)[2::]
    return bytes.fromhex(hex_).decode()
```

```console
$ python3 sol.py
[*] You have the latest version of Pwntools (4.8.0)
[+] Opening connection to challenge.404ctf.fr on port 32128: Done
404CTF{L3s_0r4cl3s_RSA_s0n7_si_fr4g1l35}
[*] Closed connection to challenge.404ctf.fr port 32128
```

## Python code
Complete solution in [sol.py](./sol.py)

## Flag
404CTF{L3s_0r4cl3s_RSA_s0n7_si_fr4g1l35}
